---
name: rotech-mobile
description: Expo/React Native mobile app patronen en conventies voor Ro-Tech klantenapp
globs:
  - mobile-app/**/*
---

# ğŸ“± RO-TECH MOBILE APP

Expo 54 / React Native 0.81 klantenapp voor het Ro-Tech klantenportaal.

---

## ğŸ“‹ APP OVERZICHT

### Functionaliteit

| Feature | Beschrijving |
|---------|--------------|
| **Login/Register** | Authenticatie met website API |
| **Dashboard** | Overzicht abonnement, uren, tickets |
| **Producten** | Lijst van klant's websites/apps |
| **Support** | Support tickets bekijken/aanmaken |
| **Instellingen** | Profiel, notificaties, uitloggen |

### Tech Stack

| Component | Technologie |
|-----------|-------------|
| Framework | Expo SDK 54 |
| Platform | React Native 0.81 |
| Navigation | React Navigation 7 |
| Storage | AsyncStorage, SecureStore |
| Taal | TypeScript (strict) |

---

## ğŸ“ BESTANDSSTRUCTUUR

```
mobile-app/
â”œâ”€â”€ App.tsx                      # Root component
â”œâ”€â”€ index.ts                     # Entry point
â”œâ”€â”€ app.json                     # Expo configuratie
â”œâ”€â”€ eas.json                     # EAS Build configuratie
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ assets/                      # App icons & splash
â”‚   â”œâ”€â”€ icon.png
â”‚   â”œâ”€â”€ adaptive-icon.png
â”‚   â”œâ”€â”€ splash-icon.png
â”‚   â””â”€â”€ favicon.png
â”‚
â””â”€â”€ src/
    â”œâ”€â”€ components/              # Reusable components
    â”‚   â””â”€â”€ ui/
    â”‚       â”œâ”€â”€ Badge.tsx
    â”‚       â”œâ”€â”€ Button.tsx
    â”‚       â”œâ”€â”€ Card.tsx
    â”‚       â”œâ”€â”€ Input.tsx
    â”‚       â””â”€â”€ index.ts
    â”‚
    â”œâ”€â”€ constants/               # App-wide constants
    â”‚   â”œâ”€â”€ config.ts            # API URLs, settings
    â”‚   â””â”€â”€ theme.ts             # Colors, spacing, fonts
    â”‚
    â”œâ”€â”€ context/                 # React Context providers
    â”‚   â””â”€â”€ AuthContext.tsx      # Auth state management
    â”‚
    â”œâ”€â”€ navigation/              # React Navigation setup
    â”‚   â””â”€â”€ AppNavigator.tsx     # Stack/Tab navigators
    â”‚
    â”œâ”€â”€ screens/                 # Screen components
    â”‚   â”œâ”€â”€ auth/
    â”‚   â”‚   â”œâ”€â”€ LoginScreen.tsx
    â”‚   â”‚   â””â”€â”€ RegisterScreen.tsx
    â”‚   â”œâ”€â”€ main/
    â”‚   â”‚   â”œâ”€â”€ DashboardScreen.tsx
    â”‚   â”‚   â”œâ”€â”€ ProductsScreen.tsx
    â”‚   â”‚   â”œâ”€â”€ SupportScreen.tsx
    â”‚   â”‚   â”œâ”€â”€ NewTicketScreen.tsx
    â”‚   â”‚   â””â”€â”€ SettingsScreen.tsx
    â”‚   â””â”€â”€ index.ts
    â”‚
    â”œâ”€â”€ services/                # API & external services
    â”‚   â”œâ”€â”€ api.ts               # API client
    â”‚   â””â”€â”€ auth.ts              # Auth functions
    â”‚
    â””â”€â”€ types/                   # TypeScript types
        â””â”€â”€ index.ts
```

---

## ğŸ¨ DESIGN SYSTEEM

### Thema Configuratie

```typescript
// src/constants/theme.ts
export const theme = {
  colors: {
    primary: '#4F46E5',        // Indigo 600
    primaryDark: '#4338CA',    // Indigo 700
    secondary: '#7C3AED',      // Violet 600
    success: '#10B981',        // Emerald 500
    warning: '#F59E0B',        // Amber 500
    error: '#EF4444',          // Red 500
    
    background: '#F8FAFC',     // Slate 50
    surface: '#FFFFFF',
    text: '#0F172A',           // Slate 900
    textMuted: '#64748B',      // Slate 500
    border: '#E2E8F0',         // Slate 200
  },
  
  spacing: {
    xs: 4,
    sm: 8,
    md: 16,
    lg: 24,
    xl: 32,
    xxl: 48,
  },
  
  borderRadius: {
    sm: 8,
    md: 12,
    lg: 16,
    xl: 24,
    full: 9999,
  },
  
  fontSize: {
    xs: 12,
    sm: 14,
    base: 16,
    lg: 18,
    xl: 20,
    '2xl': 24,
    '3xl': 30,
  },
};
```

### Config Bestand

```typescript
// src/constants/config.ts
const DEV_API_URL = 'http://localhost:3000/api';
const PROD_API_URL = 'https://ro-techdevelopment.dev/api';

export const config = {
  apiUrl: __DEV__ ? DEV_API_URL : PROD_API_URL,
  appName: 'Ro-Tech Portal',
  version: '1.0.0',
  
  // Timeouts
  apiTimeout: 30000,
  
  // Storage keys
  storageKeys: {
    authToken: 'auth_token',
    user: 'user_data',
    onboarded: 'has_onboarded',
  },
};
```

---

## ğŸ”§ CODE PATRONEN

### Screen Component

```tsx
// src/screens/main/DashboardScreen.tsx
import React, { useEffect, useState } from 'react';
import {
  View,
  Text,
  ScrollView,
  StyleSheet,
  RefreshControl,
  ActivityIndicator,
} from 'react-native';
import { useAuth } from '../../context/AuthContext';
import { api } from '../../services/api';
import { Card } from '../../components/ui';
import { theme } from '../../constants/theme';

interface DashboardData {
  subscription: {
    plan: string;
    hoursUsed: number;
    hoursIncluded: number;
  };
  openTickets: number;
  products: number;
}

export function DashboardScreen() {
  const { user } = useAuth();
  const [data, setData] = useState<DashboardData | null>(null);
  const [loading, setLoading] = useState(true);
  const [refreshing, setRefreshing] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchData = async () => {
    try {
      setError(null);
      const response = await api.get('/portal/dashboard');
      setData(response.data);
    } catch (err) {
      setError('Kon data niet laden');
    } finally {
      setLoading(false);
      setRefreshing(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  const onRefresh = () => {
    setRefreshing(true);
    fetchData();
  };

  if (loading) {
    return (
      <View style={styles.centered}>
        <ActivityIndicator size="large" color={theme.colors.primary} />
      </View>
    );
  }

  if (error) {
    return (
      <View style={styles.centered}>
        <Text style={styles.error}>{error}</Text>
      </View>
    );
  }

  return (
    <ScrollView
      style={styles.container}
      refreshControl={
        <RefreshControl refreshing={refreshing} onRefresh={onRefresh} />
      }
    >
      <Text style={styles.greeting}>
        Welkom terug, {user?.name}
      </Text>
      
      <Card style={styles.card}>
        <Text style={styles.cardTitle}>Abonnement</Text>
        <Text style={styles.cardValue}>{data?.subscription.plan}</Text>
        <Text style={styles.cardMuted}>
          {data?.subscription.hoursUsed} / {data?.subscription.hoursIncluded} uur gebruikt
        </Text>
      </Card>
      
      {/* More cards... */}
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: theme.colors.background,
    padding: theme.spacing.md,
  },
  centered: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: theme.colors.background,
  },
  greeting: {
    fontSize: theme.fontSize['2xl'],
    fontWeight: '700',
    color: theme.colors.text,
    marginBottom: theme.spacing.lg,
  },
  card: {
    marginBottom: theme.spacing.md,
  },
  cardTitle: {
    fontSize: theme.fontSize.sm,
    color: theme.colors.textMuted,
    textTransform: 'uppercase',
    letterSpacing: 0.5,
  },
  cardValue: {
    fontSize: theme.fontSize.xl,
    fontWeight: '600',
    color: theme.colors.text,
    marginTop: theme.spacing.xs,
  },
  cardMuted: {
    fontSize: theme.fontSize.sm,
    color: theme.colors.textMuted,
    marginTop: theme.spacing.xs,
  },
  error: {
    color: theme.colors.error,
    fontSize: theme.fontSize.base,
  },
});
```

### UI Component

```tsx
// src/components/ui/Button.tsx
import React from 'react';
import {
  TouchableOpacity,
  Text,
  StyleSheet,
  ActivityIndicator,
  ViewStyle,
  TextStyle,
} from 'react-native';
import { theme } from '../../constants/theme';

interface ButtonProps {
  title: string;
  onPress: () => void;
  variant?: 'primary' | 'secondary' | 'outline';
  loading?: boolean;
  disabled?: boolean;
  style?: ViewStyle;
}

export function Button({
  title,
  onPress,
  variant = 'primary',
  loading = false,
  disabled = false,
  style,
}: ButtonProps) {
  const buttonStyles = [
    styles.button,
    styles[variant],
    disabled && styles.disabled,
    style,
  ];

  const textStyles = [
    styles.text,
    variant === 'outline' && styles.outlineText,
  ];

  return (
    <TouchableOpacity
      style={buttonStyles}
      onPress={onPress}
      disabled={disabled || loading}
      activeOpacity={0.8}
    >
      {loading ? (
        <ActivityIndicator
          color={variant === 'outline' ? theme.colors.primary : '#fff'}
        />
      ) : (
        <Text style={textStyles}>{title}</Text>
      )}
    </TouchableOpacity>
  );
}

const styles = StyleSheet.create({
  button: {
    paddingVertical: theme.spacing.md,
    paddingHorizontal: theme.spacing.lg,
    borderRadius: theme.borderRadius.md,
    alignItems: 'center',
    justifyContent: 'center',
    minHeight: 48,
  },
  primary: {
    backgroundColor: theme.colors.primary,
  },
  secondary: {
    backgroundColor: theme.colors.secondary,
  },
  outline: {
    backgroundColor: 'transparent',
    borderWidth: 2,
    borderColor: theme.colors.primary,
  },
  disabled: {
    opacity: 0.5,
  },
  text: {
    color: '#fff',
    fontSize: theme.fontSize.base,
    fontWeight: '600',
  },
  outlineText: {
    color: theme.colors.primary,
  },
});
```

### API Service

```typescript
// src/services/api.ts
import * as SecureStore from 'expo-secure-store';
import { config } from '../constants/config';

interface ApiResponse<T = unknown> {
  data: T;
  error?: string;
}

class ApiClient {
  private baseUrl = config.apiUrl;
  private token: string | null = null;

  async setToken(token: string) {
    this.token = token;
    await SecureStore.setItemAsync(config.storageKeys.authToken, token);
  }

  async loadToken() {
    this.token = await SecureStore.getItemAsync(config.storageKeys.authToken);
  }

  async clearToken() {
    this.token = null;
    await SecureStore.deleteItemAsync(config.storageKeys.authToken);
  }

  private async request<T>(
    method: string,
    endpoint: string,
    body?: object
  ): Promise<ApiResponse<T>> {
    const headers: HeadersInit = {
      'Content-Type': 'application/json',
    };

    if (this.token) {
      headers['Authorization'] = `Bearer ${this.token}`;
    }

    try {
      const response = await fetch(`${this.baseUrl}${endpoint}`, {
        method,
        headers,
        body: body ? JSON.stringify(body) : undefined,
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || 'Request failed');
      }

      return { data };
    } catch (error) {
      throw error;
    }
  }

  get<T>(endpoint: string) {
    return this.request<T>('GET', endpoint);
  }

  post<T>(endpoint: string, body: object) {
    return this.request<T>('POST', endpoint, body);
  }

  put<T>(endpoint: string, body: object) {
    return this.request<T>('PUT', endpoint, body);
  }

  delete<T>(endpoint: string) {
    return this.request<T>('DELETE', endpoint);
  }
}

export const api = new ApiClient();
```

### Auth Context

```tsx
// src/context/AuthContext.tsx
import React, {
  createContext,
  useContext,
  useState,
  useEffect,
  ReactNode,
} from 'react';
import { api } from '../services/api';
import * as SecureStore from 'expo-secure-store';
import { config } from '../constants/config';

interface User {
  id: string;
  email: string;
  name: string;
}

interface AuthContextType {
  user: User | null;
  loading: boolean;
  login: (email: string, password: string) => Promise<void>;
  logout: () => Promise<void>;
  register: (name: string, email: string, password: string) => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadUser();
  }, []);

  const loadUser = async () => {
    try {
      await api.loadToken();
      const userData = await SecureStore.getItemAsync(config.storageKeys.user);
      if (userData) {
        setUser(JSON.parse(userData));
      }
    } catch (error) {
      console.error('Failed to load user:', error);
    } finally {
      setLoading(false);
    }
  };

  const login = async (email: string, password: string) => {
    const { data } = await api.post<{ token: string; user: User }>(
      '/auth/login',
      { email, password }
    );
    
    await api.setToken(data.token);
    await SecureStore.setItemAsync(
      config.storageKeys.user,
      JSON.stringify(data.user)
    );
    setUser(data.user);
  };

  const logout = async () => {
    await api.clearToken();
    await SecureStore.deleteItemAsync(config.storageKeys.user);
    setUser(null);
  };

  const register = async (name: string, email: string, password: string) => {
    const { data } = await api.post<{ token: string; user: User }>(
      '/auth/register',
      { name, email, password }
    );
    
    await api.setToken(data.token);
    await SecureStore.setItemAsync(
      config.storageKeys.user,
      JSON.stringify(data.user)
    );
    setUser(data.user);
  };

  return (
    <AuthContext.Provider value={{ user, loading, login, logout, register }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
}
```

### Navigation Setup

```tsx
// src/navigation/AppNavigator.tsx
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createNativeStackNavigator } from '@react-navigation/native-stack';
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import { useAuth } from '../context/AuthContext';
import { theme } from '../constants/theme';

// Screens
import { LoginScreen, RegisterScreen } from '../screens/auth';
import {
  DashboardScreen,
  ProductsScreen,
  SupportScreen,
  NewTicketScreen,
  SettingsScreen,
} from '../screens/main';

const Stack = createNativeStackNavigator();
const Tab = createBottomTabNavigator();

function MainTabs() {
  return (
    <Tab.Navigator
      screenOptions={{
        tabBarActiveTintColor: theme.colors.primary,
        tabBarInactiveTintColor: theme.colors.textMuted,
        headerStyle: { backgroundColor: theme.colors.surface },
        headerTitleStyle: { color: theme.colors.text },
      }}
    >
      <Tab.Screen name="Dashboard" component={DashboardScreen} />
      <Tab.Screen name="Producten" component={ProductsScreen} />
      <Tab.Screen name="Support" component={SupportScreen} />
      <Tab.Screen name="Instellingen" component={SettingsScreen} />
    </Tab.Navigator>
  );
}

export function AppNavigator() {
  const { user, loading } = useAuth();

  if (loading) {
    return null; // Or splash screen
  }

  return (
    <NavigationContainer>
      <Stack.Navigator screenOptions={{ headerShown: false }}>
        {user ? (
          <>
            <Stack.Screen name="Main" component={MainTabs} />
            <Stack.Screen
              name="NewTicket"
              component={NewTicketScreen}
              options={{ headerShown: true, title: 'Nieuw Ticket' }}
            />
          </>
        ) : (
          <>
            <Stack.Screen name="Login" component={LoginScreen} />
            <Stack.Screen name="Register" component={RegisterScreen} />
          </>
        )}
      </Stack.Navigator>
    </NavigationContainer>
  );
}
```

---

## âš ï¸ ANTI-PATTERNS

```typescript
// âŒ NOOIT: Inline styles overal
<View style={{ marginTop: 20, padding: 16 }}>

// âœ… ALTIJD: StyleSheet.create
<View style={styles.container}>

// âŒ NOOIT: Hardcoded kleuren
<Text style={{ color: '#4F46E5' }}>

// âœ… ALTIJD: Theme gebruiken
<Text style={{ color: theme.colors.primary }}>

// âŒ NOOIT: Tokens in plain text opslaan
await AsyncStorage.setItem('token', token);

// âœ… ALTIJD: SecureStore voor gevoelige data
await SecureStore.setItemAsync('token', token);

// âŒ NOOIT: Geen loading/error states
const [data, setData] = useState(null);

// âœ… ALTIJD: Complete state management
const [data, setData] = useState(null);
const [loading, setLoading] = useState(true);
const [error, setError] = useState<string | null>(null);
```

---

## ğŸš€ DEVELOPMENT COMMANDS

```bash
cd mobile-app

# Development
npm start                 # Start Expo
npm run android          # Android emulator
npm run ios              # iOS simulator  
npm run web              # Web browser

# Building
eas build --platform android
eas build --platform ios
eas submit --platform ios
```

---

## ğŸ“¦ KEY DEPENDENCIES

| Package | Gebruik |
|---------|---------|
| `expo` | Core framework |
| `react-navigation` | Navigation |
| `expo-secure-store` | Secure token storage |
| `@react-native-async-storage/async-storage` | General storage |
| `expo-constants` | App constants |
| `expo-linking` | Deep linking |
